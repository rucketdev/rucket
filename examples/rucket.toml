# Copyright 2024 The Rucket Authors
# SPDX-License-Identifier: Apache-2.0

# Example Rucket configuration file

[server]
# Address and port to bind to
bind = "127.0.0.1:9000"

[storage]
# Directory for storing object data and metadata
data_dir = "./data"

# Sync configuration for durability vs performance tuning
[storage.sync]
# Data file sync strategy:
#   "none"      - No sync, fastest, data may be lost on crash
#   "periodic"  - Sync at intervals (default, good balance)
#   "threshold" - Sync after bytes/ops threshold
#   "always"    - Sync every write, slowest but safest
data = "periodic"

# Metadata (SQLite) sync strategy - same options as above
metadata = "always"

# Interval in milliseconds for periodic sync (default: 1000)
interval_ms = 1000

# Bytes threshold for threshold-based sync (default: 10MB)
bytes_threshold = 10485760

# Operations threshold for threshold-based sync (default: 100)
ops_threshold = 100

# Minimum file size to use direct I/O, 0 to disable (Linux only)
direct_io_min_size = 0

# SQLite database configuration for metadata
[storage.sqlite]
# Journal mode:
#   "delete" - Delete journal after commit (traditional, slower)
#   "wal"    - Write-Ahead Logging (default, better concurrent performance)
#   "memory" - Journal in memory only (no crash recovery)
#   "off"    - No journaling (dangerous)
journal_mode = "wal"

# Synchronous mode (durability vs speed):
#   "off"    - No sync, fastest, highest risk of corruption
#   "normal" - Sync at critical moments (default, process-crash safe)
#   "full"   - Sync every write to journal (power-failure safe)
#   "extra"  - Like full but also syncs directory entries
synchronous = "normal"

# How long to wait when database is locked (milliseconds)
busy_timeout_ms = 5000

# Page cache size in KiB (negative) or pages (positive)
# Default: -64000 = 64 MiB cache
cache_size = -64000

# WAL size limit before auto-checkpoint (bytes)
# Only used when journal_mode = "wal"
wal_size_limit = 10485760

[auth]
# AWS-compatible credentials
access_key = "rucket"
secret_key = "rucket123"

[bucket]
# Bucket naming rules: "strict" (S3 DNS-compatible) or "relaxed"
naming_rules = "relaxed"

[logging]
# Log level: trace, debug, info, warn, error
level = "info"
# Log format: "json" or "pretty"
format = "pretty"
